{{ 'bundle.css' | asset_url | stylesheet_tag }}
<h1 class="compl-heading">{{ section.settings.heading }}</h1>
<div class="compl-container">
  {%- for block in section.blocks -%}
    {% render 'bundle', card_product: block.settings.product %}
    {% assign total_price = total_price | plus: block.settings.product.price %}
  {% endfor %}
  <div class="total-cont">
    <p>{{ section.settings.paragraph }}: {{ total_price | money }}</p>
    <button type="submit" class="button button--secondary">Add to cart</button>
  </div>
</div>
<script>
  function addToCart() {
    var products = [];

    // Assuming your bundle snippet generates product information with IDs and quantities
    {%- for block in section.blocks -%}
      var product = {
        id: '{{ block.settings.product.id }}',
        quantity: 1, // You can adjust the quantity as needed
      };
      products.push(product);
    {% endfor %}

    var data = {
      items: products,
    };

    fetch('/cart/add-multi.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      },
      body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(data => {
      // Handle the response, maybe redirect to the cart page
      window.location.href = '/cart';
    })
    .catch(error => console.error('Error:', error));
  }
</script>

{% schema %}
{
  "name": "Bundle",
  "tag": "section",
   "class": "container product-container pad",
   "settings": [
  {
      "type": "inline_richtext",
      "id": "heading",
      "default": "Perfectly pairs with",
      "label": "Heading"
    },
     {
      "type": "inline_richtext",
      "id": "paragraph",
      "default": "Total",
      "label": "Total price"
    }
  ],

  "blocks": [
  {
    "type": "featured_product",
    "name": "t:sections.featured-product.name",
    "settings": [
      {
        "type": "product",
        "id": "product",
        "label": "t:sections.featured-product.blocks.featured-product.settings.product.label"
      }
    ]
  }
],
"presets": [
  {
    "name": "Product section",
    "blocks": [
      {
        "type": "featured_product"
      },
      {
        "type": "featured_product"
      },
      {
        "type": "featured_product"
      }

    ]
  }
]
}
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
