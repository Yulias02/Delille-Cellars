{%- for block in section.blocks -%}
  {% render 'custom-product', placeholder_image: placeholder_image, card_product: block.settings.product %}
{% endfor %}
{{ 'custom-product.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
<script>
    const addToCartForms = document.querySelectorAll('form[action^="/cart/add"]');


    addToCartForms.forEach((form) => {
      form.addEventListener("submit", (event) => {
        event.preventDefault();

  //        let inputQuantity = parseInt(document.querySelector('.qty-input').value);
  //   let availableQuantity = parseInt( product.selected_or_first_available_variant.inventory_quantity );
  // console.log(availableQuantity)
  //   if (inputQuantity > availableQuantity) {
  //     alert("You can only add " + availableQuantity + " of this item to your cart.");
  //   }

        const submitButton = form.querySelector('.buy-now');
        const spinner = form.querySelector('.loading-overlay__spinner');

          submitButton.classList.add('hidden');
          spinner.classList.remove('hidden');

        fetch("/cart/add.js", {
          method: "post",
          body: new FormData(form),
        })
          .then((response) => {
              return response.json();
          })
          .then((data) => {
              spinner.classList.add('hidden');
              submitButton.classList.remove('hidden');
          })
          .catch((error) => {
            console.error('Error:', error);
              spinner.classList.add('hidden');
              submitButton.classList.add('hidden');
          });
      });
    });
</script>
{% schema %}
 {
  "name": "Product Section",
  "tag": "section",
  "class": "section page-width new-wine container",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "blocks": [
    {
      "type": "featured_product",
      "name": "t:sections.featured-product.name",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "t:sections.featured-product.blocks.featured-product.settings.product.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product",
      "blocks": [
        {
          "type": "featured_product"
        },
        {
          "type": "featured_product"
        }

      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
 
{% endstylesheet %}

{% javascript %}
  // const addToCartForms = document.querySelectorAll('form[action^="/cart/add"]');

  // addToCartForms.forEach((form) => {
  //   form.addEventListener("submit", (event) => {
  //     event.preventDefault();

  //     const submitButton = form.querySelector('.buy-now');
  //     const spinner = form.querySelector('.loading-overlay__spinner');

  //       submitButton.classList.add('hidden');
  //       spinner.classList.remove('hidden');

  //     fetch("/cart/add.js", {
  //       method: "post",
  //       body: new FormData(form),
  //     })
  //       .then((response) => {
  //           return response.json();
  //       })
  //       .then((data) => {
  //           spinner.classList.add('hidden');
  //           submitButton.classList.remove('hidden');
  //       })
  //       .catch((error) => {
  //         console.error('Error:', error);
  //           spinner.classList.add('hidden');
  //           submitButton.classList.add('hidden');
  //       });
  //   });
  // });
{% endjavascript %}
